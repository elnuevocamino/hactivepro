import{generateTemplatedPrompt,displayPrompt}from"./prompt-generator.js";import{loadFormLogic}from"./form-logic-loader.js";const formContainer=document.getElementById("form-viewer-container"),generateBtn=document.getElementById("generatePromptBtn"),outputContainer=document.getElementById("prompt-output-container"),MANIFEST_URL="/content/prompts/prompts-manifest.json";async function loadCustomForm(e,o){try{const t=await fetch(o);if(!t.ok)throw new Error(`No se encontró el formulario en ${o}. Estado: ${t.status}`);const r=await t.text();formContainer.innerHTML=r;const n=await loadFormLogic(e);return n&&"function"==typeof n.initialize&&n.initialize(),n}catch(e){return console.error("Error al cargar el formulario:",e),formContainer.innerHTML='<p class="error-message">Hubo un problema al cargar el formulario. Es posible que no exista o haya un error de red. Revisa que la URL sea correcta (ej: ?form=blog_form).</p>',generateBtn&&(generateBtn.style.display="none"),null}}function setupEventListeners(e,o){generateBtn?generateBtn.addEventListener("click",()=>{outputContainer&&(outputContainer.style.display="none");const t=formContainer.querySelector(".prompt-form");if(t)if(o&&"function"==typeof o.generate){const e=o.generate(t);displayPrompt(e,outputContainer)}else console.warn(`No se encontró una función 'generate' para el formId: ${e}.`);else console.error("No se encontró un elemento .prompt-form dentro del contenedor para generar el prompt.")}):console.error("El botón #generatePromptBtn no se encontró en la página.")}export async function initializeFormViewer(){if(formContainer)try{const e=new URLSearchParams(window.location.search).get("form");if(!e)throw new Error("No se especificó un ID de formulario en la URL.");const o=await fetch(MANIFEST_URL);if(!o.ok)throw new Error("No se pudo cargar el manifiesto de prompts.");const t=(await o.json()).find(o=>o.id===e);if(!t)throw new Error(`No se encontró un prompt con el ID "${e}" en el manifiesto.`);const r=document.getElementById("form-title"),n=document.getElementById("form-description");r&&(r.textContent=t.title),n&&(n.textContent=t.description),document.title=`${t.title} - HactivePro`;let a=null;if(t.customPagePath)a=await loadCustomForm(e,t.customPagePath);else{if(!t.templatedJsonPath)throw new Error(`El manifiesto para "${e}" no especifica una ruta válida (customPagePath o templatedJsonPath).`);console.log(`TODO: Implementar la carga del formulario templado desde: ${t.templatedJsonPath}`),formContainer.innerHTML="<p>Este formulario se cargará desde un JSON.</p>"}setupEventListeners(e,a)}catch(e){console.error("Error al inicializar el visor de formularios:",e),formContainer.innerHTML=`<p class="error-message">${e.message} Por favor, vuelve a la <a href="/content/prompts/prompts.html">galería de prompts</a>.</p>`,generateBtn&&(generateBtn.style.display="none")}else console.error("Contenedor de formulario #form-viewer-container no encontrado. Abortando.")}